<%#
LuCI - Lua Configuration Interface
Copyright 2008 Steven Barth <steven@midlink.org>
Copyright 2008 Jo-Philipp Wich <xm@leipzig.freifunk.net>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

$Id: header.htm 4891 2009-06-22 10:23:21Z jow $

-%>
<%
require("luci.sys")
uci = require("luci.model.uci").cursor()
--require("luci.i18n").loadc("default")
local i18n = require("luci.i18n")
require("luci.http").prepare_content("text/html")
local lang = uci:get("system","main","language")
i18n.load("admin-core",lang)
i18n.setlanguage(lang)

-%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" title="Standard" href="../mode/easy/images/css.css" type="text/css" media="screen" />
<title>.::Welcome to ZyXEL NBG6616::.</title>
<link href="/luci-static/zyxel/css/expert.css" rel="stylesheet"type="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<script type="text/JavaScript">

</script>


<body >
<form method="post" name="WWANUP" action="<%=controller%>/expert/configuration/network/wan/wwanupdown" onSubmit="return CheckValue();"> 
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td><table width="100%" height="37" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td width="19" height="37" valign="top"><img src="/luci-static/zyxel/admin/images/popup_top_left.gif" width="19" height="45" /></td>
          <td background="/luci-static/zyxel/admin/images/popup_top_center.gif" class="about_title"><%:Warning_3G_Status%></td>
          <td width="15" background="/luci-static/zyxel/admin/images/popup_top_center.gif">&nbsp;</td>
          <td width="19" height="45" valign="top"><img src="/luci-static/zyxel/admin/images/popup_top_right.gif" width="19" height="45" /></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td><table width="100%" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td width="19" background="/luci-static/zyxel/admin/images/popup_main_left.gif">&nbsp;</td>
          <td bgcolor="#FFFFFF"><span class="popupcontent">
            </span>
			<%
			local Card_status = luci.sys.exec("cat /tmp/3g_status")
			local Card_status_upper = Card_status:gsub("[a-zA-Z]", string.upper)
			if not Card_status then
				Card_status = "N/A"
			end
			
			local Card_Provider = luci.sys.exec("cat /tmp/3g_provider | grep '+COPS:' | cut -d ',' -f3")
			if Card_Provider == "" then
				Card_Provider = "N/A"
			end
			
			luci.sys.exec("sh /sbin/rssi_dbm.sh")
			local Card_dbm = luci.sys.exec("cat /tmp/3g_signal_strength | sed -n '1p'")
			local Card_strength = luci.sys.exec("cat /tmp/3g_signal_strength | sed -n '2p'")
			if Card_dbm == "" then
				Card_dbm = "N/A"
			end		
			
			Manufacturer11 = luci.sys.exec("cat /tmp/3g_Manufac | grep -v '^$' | grep -B 1 'OK' | sed 's/OK//g' | sed '/^$/d'")
			local Card_Manufacturer = Manufacturer11:gsub("[a-zA-Z]", string.upper)
			if Card_Manufacturer == "" then
				Card_Manufacturer  = "N/A"
			end
			
			local Card_Model = luci.sys.exec("cat /tmp/3g_Model | grep -v '^$' | grep -B 1 'OK' | sed 's/OK//g' | sed '/^$/d'")
			if Card_Model == "" then
				Card_Model  = "N/A"
			end
			
			local Card_Revision = luci.sys.exec("cat /tmp/3g_Fw | grep -v '^$' | grep -B 1 'OK' | sed 's/OK//g' | sed '/^$/d'")
			if Card_Revision == "" then
				Card_Revision  = "N/A"
			end
			
			local Card_IMEI = luci.sys.exec("cat /tmp/3g_IMEI | grep -v '^$' | grep -B 1 'OK' | sed 's/OK//g' | sed '/^$/d'")
			if Card_IMEI == "" then
				Card_IMEI  = "N/A"
			end
			
			local Card_IMSI = luci.sys.exec("cat /tmp/3g_imsi | grep '[0-9]'")
			if Card_IMSI == "" then
				Card_IMSI  = "N/A"
			end
		
			local internet_state=luci.sys.exec("ifconfig ppp0")
			local ppp0_ip=string.match(internet_state,"inet addr:(%d+.%d+.%d+.%d+)")
			local fail_state=luci.sys.exec("ls /tmp/3g_time")

			luci.sys.exec("sh /sbin/time_count.sh")  
			local up_time_state=luci.sys.exec("ls /tmp/time_count")
			local up_time
			if up_time_state == "/tmp/time_count\n" then			
				up_time=luci.sys.exec("cat /tmp/time_count")
			else
				up_time=0
			end
			local ca_date=up_time/86400
			local ca_hour=(up_time/3600)%24
			local ca_minute=(up_time/60)%60
			local ca_second=up_time%60
				  

			%>
			
			
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Status%>:</li>
				<li class="right_table" style=" color:#0b70fc;"><%=Card_status_upper%></li>
				</ul>
			</div>
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Service_Provider%>:</li>
				<li class="right_table" style=" color:#0b70fc;"><%=Card_Provider%></li>
				</ul>
			</div>
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Signal_Strength%>:</li>
				<li class="right_table" style=" color:#0b70fc;"><%=Card_dbm%><%=Card_strength%></li>
				</ul>
			</div>
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Connection_Uptime%>:</li>
				<li class="right_table" style=" color:#0b70fc;">
				<% if ppp0_ip and fail_state == "/tmp/3g_time\n" then %>
				<%=math.floor(ca_date)%><%:day%> <%=math.floor(ca_hour)%><%:hr%> <%=math.floor(ca_minute)%><%:min%> <%=ca_second%><%:sec%>
				<%else%>
				0<%:day%> 0<%:hr%> 0<%:min%> 0<%:sec%>			
				<%end%>
				</li>
				</ul>
			</div>
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Card_Manufacturer%>:</li>
				<li class="right_table" style=" color:#0b70fc;"><%=Card_Manufacturer%></li>
				</ul>
			</div>
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Card_Model%>:</li>
				<li class="right_table" style=" color:#0b70fc;"><%=Card_Model%></li>
				</ul>
			</div>
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Card_FW_Version%>:</li>
				<li class="right_table" style=" color:#0b70fc;"><%=Card_Revision%></li>
				</ul>
			</div>
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Card_IMEI%>:</li>
				<li class="right_table" style=" color:#0b70fc;"><%=Card_IMEI%></li>
				</ul>
			</div>
			<div class="w_text">
				<ul>
				<li class="left_table" style=" font-size:12px; text-align:left;"><%:Card_IMSI%>:</li>
				<li class="right_table" style=" color:#0b70fc;"><%=Card_IMSI%></li>
				</ul>
			</div>
			<div class="spaceair"></div>
		  </td>
          <td width="19" background="/luci-static/zyxel/admin/images/popup_main_right.gif">&nbsp;</td>
        </tr>
      </table></td>
  </tr>
<tr>
<td>
	<table width="100%" height="37" border="0" cellpadding="0" cellspacing="0">
		<tr>
		<td width="19" height="48"><img src="<%=media%>/easy/images/popup_down_left.gif" width="19" height="48" /></td>
		<td background="<%=media%>/easy/images/popup_down_center.gif">
			<div class="button2"><ul>
			<li><center>
				<input name="OK" value="OK" type="button" onclick="window.close()"/>
			</center></li>
			</ul></div>
		</td>
		<td width="19" height="37"><img src="<%=media%>/easy/images/popup_down_right.gif" width="19" height="48" /></td>
		</tr>
	</table>
</td>
</tr>

</table>
</body>
</html>

