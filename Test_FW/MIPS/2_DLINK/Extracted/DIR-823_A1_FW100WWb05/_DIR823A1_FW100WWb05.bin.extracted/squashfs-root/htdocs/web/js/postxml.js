function Authenticate(b,a){this.AuthorizedGroup=b;this.timeout=a}Authenticate.prototype={AuthorizedGroup:-1,TimeoutCallback:null,captcha:null,timerid:null,timeout:600,CancelTimeout:function(){if(this.timerid){clearTimeout(this.timerid);this.timerid=null}},UpdateTimeout:function(){var a=this;this.CancelTimeout();if(this.AuthorizedGroup>=0){this.timerid=setTimeout(function(){a.CancelTimeout();if(a.TimeoutCallback){a.Logout(a.TimeoutCallback())}},this.timeout*1000)}},Captcha:function(c){var b=this;var a=GetAjaxObj("captcha");a.release();a.createRequest();a.onCallback=function(d){if(c){c(d)}a.release()};a.setHeader("Content-Type","application/x-www-form-urlencoded");a.sendRequest("captcha.cgi","DUMMY=YES");this.UpdateTimeout()},Login:function(g,d,c,e){if(this.AuthorizedGroup>=0){if(g){g(null)}return}var b=this;var f="REPORT_METHOD=xml&ACTION=login_plaintext&USER="+escape(d)+"&PASSWD="+escape(c)+"&CAPTCHA="+escape(e);var a=GetAjaxObj("login");a.release();a.createRequest();a.onCallback=function(h){if(h.Get("/report/RESULT")=="SUCCESS"){b.AuthorizedGroup=h.Get("/report/AUTHORIZED_GROUP");b.UpdateTimeout()}a.release();if(g){g(h)}};a.setHeader("Content-Type","application/x-www-form-urlencoded");a.sendRequest("session.cgi",f)},Login_Hash:function(g,d,c,e){if(this.AuthorizedGroup>=0){if(g){g(null)}return}var b=this;var f=new Date().getTime();var a=GetAjaxObj("login_hash");a.createRequest();a.onCallback=function(h){b.Login_Send_Digest(g,d,c,h)};a.setHeader("Content-Type","application/x-www-form-urlencoded");a.requestMethod="GET";a.returnXml=false;a.sendRequest("authentication.cgi?captcha="+e+"&dummy="+f,"")},Login_Send_Digest:function(callback,user,passwd,json){var JsonData=eval("("+json+")");if(JsonData.status!="ok"){if(callback){callback(json)}return}if(navigator.cookieEnabled){document.cookie="uid="+JsonData.uid+"; path=/"}var key=passwd;var mix=user+JsonData.challenge;var digest=hex_hmac_md5(key,mix);var DIGEST=digest.toUpperCase();var payload="id="+user+"&password="+DIGEST;var AJAX=GetAjaxObj("login_send_digest");AJAX.release();AJAX.createRequest();AJAX.onCallback=function(json){if(callback){callback(json)}};AJAX.setHeader("Content-Type","application/x-www-form-urlencoded");AJAX.returnXml=false;AJAX.sendRequest("authentication.cgi",payload)},Logout:function(d){if(this.AuthorizedGroup<0){if(d){d(null)}return}var b=this;var c="REPORT_METHOD=xml&ACTION=logout";var a=GetAjaxObj("login");a.release();a.createRequest();a.onCallback=function(e){if(d){d(e)}b.AuthorizedGroup=-1;a.release()};a.setHeader("Content-Type","application/x-www-form-urlencoded");a.sendRequest("session.cgi",c)}};function PostXML(a){if(a){this.pwpost=a}}PostXML.prototype={pwpost:"SETCFG,SAVE,ACTIVATE",doc:null,callback:null,hedwig_callback:function(b){var a=this;switch(b.Get("/hedwig/result")){case"OK":COMM_CallPigwidgeon(this.pwpost,function(c){a.pigwidgeon_callback(c)});break;case"BUSY":if(this.callback){this.callback("BUSY",null)}break;default:if(this.callback){this.callback("HEDWIG",b)}break}},pigwidgeon_callback:function(a){switch(a.Get("/pigwidgeon/result")){case"OK":if(this.callback){this.callback("OK",null)}break;default:if(this.callback){this.callback("PIGWIDGEON",a)}break}},UpdatePostXML:function(a){this.doc=a},GetCFG:function(a,c){var b=this;this.callback=c;COMM_GetCFG(false,a,function(d){b.doc=d;if(b.callback){b.callback();b.callback=null}})},FindModule:function(a){if(this.doc===null){return null}return this.doc.GetPathByTarget("/postxml","module","service",a,false)},ActiveModule:function(c){var a=this.FindModule(c);if(a===null){return false}this.doc.Del(a+"/FATLADY");this.doc.Del(a+"/SETCFG");this.doc.Del(a+"/ACTIVATE");return true},DelayActiveModule:function(d,c){var a=this.FindModule(d);if(a===null){return false}this.doc.Set(a+"/ACTIVATE","delay");this.doc.Set(a+"/ACTIVATE_DELAY",c);return true},EventActiveModule:function(d,e,c){var a=this.FindModule(d);if(a===null){return false}this.doc.Set(a+"/ACTIVATE","event");this.doc.Set(a+"/ACTIVATE_EVENT",e);this.doc.Set(a+"/ACTIVATE_DELAY",c?c:"");return true},IgnoreModule:function(c){var a=this.FindModule(c);if(a===null){return false}this.doc.Set(a+"/FATLADY","ignore");this.doc.Set(a+"/SETCFG","ignore");this.doc.Set(a+"/ACTIVATE","ignore");return true},CheckModule:function(e,c,d,f){var a=this.FindModule(e);if(a===null){return false}if(c){this.doc.Set(a+"/FATLADY",c)}else{this.doc.Del(a+"/FATLADY")}if(d){this.doc.Set(a+"/SETCFG",d)}else{this.doc.Del(a+"/SETCFG")}if(f){this.doc.Set(a+"/ACTIVATE",f)}else{this.doc.Del(a+"/ACTIVATE")}return true},Post:function(b){var a=this;this.callback=b;COMM_CallHedwig(this.doc,function(c){a.hedwig_callback(c)})}};